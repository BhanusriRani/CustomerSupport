name: One Click Copilot Deployment (OIDC)

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install Power Platform CLI
        uses: microsoft/powerplatform-actions/actions-install@v1

      - name: Authenticate using OIDC
        uses: microsoft/powerplatform-actions/authenticate@v1
        with:
          app-id: ${{ secrets.PP_CLIENT_ID }}
          tenant-id: ${{ secrets.PP_TENANT_ID }}
          environment-url: ${{ secrets.PP_ENV_URL }}

      - name: Import Managed Solution
        uses: microsoft/powerplatform-actions/import-solution@v1
        with:
          solution-file: solutions/CustomerSupport/CustomerSupport_managed.zip
          publish-changes: true
